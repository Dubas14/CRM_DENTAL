# Telegram –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –¥–ª—è –õ—ñ–∫–∞—Ä—ñ–≤

## –û–≥–ª—è–¥

–°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å –¥–ª—è –ª—ñ–∫–∞—Ä—ñ–≤ —á–µ—Ä–µ–∑ Telegram Bot API. –õ—ñ–∫–∞—Ä—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤–∞–∂–ª–∏–≤—ñ –ø–æ–¥—ñ—ó, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ —ó—Ö —Ä–æ–∑–∫–ª–∞–¥–æ–º —Ç–∞ –∑–∞–ø–∏—Å–∞–º–∏.

## –¢—Ä–∏–≥–µ—Ä–∏ –ø–æ–¥—ñ–π

### 1. –ù–æ–≤–∏–π –∑–∞–ø–∏—Å
- **–ö–æ–ª–∏**: –°—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å –¥–ª—è –ª—ñ–∫–∞—Ä—è
- **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**: 
  ```
  üìÖ –ù–æ–≤–∏–π –∑–∞–ø–∏—Å
  –ü–∞—Ü—ñ—î–Ω—Ç: {patient_name}
  –î–∞—Ç–∞/—á–∞—Å: {start_at} - {end_at}
  –ü—Ä–æ—Ü–µ–¥—É—Ä–∞: {procedure_name}
  –ö–∞–±—ñ–Ω–µ—Ç: {room_name}
  ```

### 2. –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É
- **–ö–æ–ª–∏**: –ó–∞–ø–∏—Å –ª—ñ–∫–∞—Ä—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –Ω–∞ —ñ–Ω—à–∏–π —á–∞—Å
- **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**:
  ```
  üîÑ –ó–∞–ø–∏—Å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ
  –ü–∞—Ü—ñ—î–Ω—Ç: {patient_name}
  –°—Ç–∞—Ä–∏–π —á–∞—Å: {old_start_at}
  –ù–æ–≤–∏–π —á–∞—Å: {new_start_at} - {new_end_at}
  ```

### 3. –°–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É
- **–ö–æ–ª–∏**: –ó–∞–ø–∏—Å –ª—ñ–∫–∞—Ä—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ
- **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**:
  ```
  ‚ùå –ó–∞–ø–∏—Å —Å–∫–∞—Å–æ–≤–∞–Ω–æ
  –ü–∞—Ü—ñ—î–Ω—Ç: {patient_name}
  –î–∞—Ç–∞/—á–∞—Å: {start_at} - {end_at}
  –ü—Ä–∏—á–∏–Ω–∞: {cancellation_reason}
  ```

### 4. –†–∞–Ω–∫–æ–≤–∏–π –¥–∞–π–¥–∂–µ—Å—Ç
- **–ö–æ–ª–∏**: –©–æ–¥–Ω—è –æ 08:00 (–Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è)
- **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**:
  ```
  üåÖ –î–æ–±—Ä–æ–≥–æ —Ä–∞–Ω–∫—É!
  –°—å–æ–≥–æ–¥–Ω—ñ —É –≤–∞—Å –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ:
  ‚Ä¢ {count} –∑–∞–ø–∏—Å—ñ–≤
  –ü–µ—Ä—à–∏–π –∑–∞–ø–∏—Å: {first_appointment_time}
  ```

## –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îî‚îÄ‚îÄ Notifications/
‚îÇ       ‚îú‚îÄ‚îÄ TelegramGateway.php      # –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è Telegram API
‚îÇ       ‚îî‚îÄ‚îÄ TelegramBotGateway.php    # –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Bot API
‚îú‚îÄ‚îÄ Notifications/
‚îÇ   ‚îî‚îÄ‚îÄ Doctor/
‚îÇ       ‚îú‚îÄ‚îÄ AppointmentCreatedNotification.php
‚îÇ       ‚îú‚îÄ‚îÄ AppointmentRescheduledNotification.php
‚îÇ       ‚îú‚îÄ‚îÄ AppointmentCancelledNotification.php
‚îÇ       ‚îî‚îÄ‚îÄ DailyDigestNotification.php
‚îî‚îÄ‚îÄ Console/
    ‚îî‚îÄ‚îÄ Commands/
        ‚îî‚îÄ‚îÄ SendDailyDigest.php      # Cron –∫–æ–º–∞–Ω–¥–∞
```

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

**config/services.php:**
```php
'telegram' => [
    'bot_token' => env('TELEGRAM_BOT_TOKEN'),
    'api_url' => env('TELEGRAM_API_URL', 'https://api.telegram.org/bot'),
],
```

**.env:**
```
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_ENABLED=true
```

### –ú–æ–¥–µ–ª—å User

–î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ `telegram_chat_id` –¥–æ —Ç–∞–±–ª–∏—Ü—ñ `users`:

```php
// Migration
Schema::table('users', function (Blueprint $table) {
    $table->string('telegram_chat_id')->nullable()->after('phone');
    $table->boolean('telegram_notifications_enabled')->default(false)->after('telegram_chat_id');
});
```

### Throttling

- –ú–∞–∫—Å–∏–º—É–º 10 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É –Ω–∞ –æ–¥–Ω–æ–≥–æ –ª—ñ–∫–∞—Ä—è
- –ú–∞–∫—Å–∏–º—É–º 100 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ –≥–æ–¥–∏–Ω—É –Ω–∞ –æ–¥–Ω–æ–≥–æ –ª—ñ–∫–∞—Ä—è
- –†–∞–Ω–∫–æ–≤–∏–π –¥–∞–π–¥–∂–µ—Å—Ç: 1 —Ä–∞–∑ –Ω–∞ –¥–µ–Ω—å

### –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –º–µ—Ç—Ä–∏–∫–∏

- –õ–æ–≥—É–≤–∞—Ç–∏ –≤—Å—ñ —Å–ø—Ä–æ–±–∏ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ (—É—Å–ø—ñ—à–Ω—ñ —Ç–∞ –Ω–µ–≤–¥–∞–ª—ñ)
- –ú–µ—Ç—Ä–∏–∫–∏:
  - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
  - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫
  - –°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API

### –ë–µ–∑–ø–µ–∫–∞

- –í–∞–ª—ñ–¥–∞—Ü—ñ—è `telegram_chat_id` –ø–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î —Ä–æ–ª—å `doctor`
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ `telegram_notifications_enabled = true`

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```php
// –£ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ –∞–±–æ —Å–µ—Ä–≤—ñ—Å—ñ
$doctor = User::find($doctorId);
$doctor->notify(new AppointmentCreatedNotification($appointment));
```

## –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

- –ö–Ω–æ–ø–∫–∏ –¥—ñ–π –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è—Ö (–ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏/—Å–∫–∞—Å—É–≤–∞—Ç–∏)
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∏–ø—ñ–≤ –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å (—è–∫—ñ –ø–æ–¥—ñ—ó –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏)
- –ì—Ä—É–ø–æ–≤—ñ —á–∞—Ç–∏ –¥–ª—è –∫–ª—ñ–Ω—ñ–∫–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

